<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal Charter</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/public/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/public/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/public/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/public/apple-touch-icon.png">
    <link rel="manifest" href="/public/site.webmanifest">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #2c1810;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
        }

        .hero {
            min-height: 100vh;
            display: flex;
            align-items: center;
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 50%, #ff6b35 100%);
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="40" r="1" fill="rgba(255,255,255,0.2)"/><circle cx="40" cy="80" r="1.5" fill="rgba(255,255,255,0.15)"/></svg>');
            animation: float 20s infinite linear;
        }

        @keyframes float {
            0% { transform: translateY(0px) rotate(0deg); }
            100% { transform: translateY(-100px) rotate(360deg); }
        }

        .hero-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4rem;
            align-items: center;
            position: relative;
            z-index: 1;
        }

        .hero-text h1 {
            font-size: 3.5rem;
            font-weight: 700;
            color: white;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .hero-text .subtitle {
            font-size: 1.25rem;
            color: rgba(255,255,255,0.9);
            margin-bottom: 2rem;
            font-style: italic;
        }

        .hero-text p {
            font-size: 1.1rem;
            color: rgba(255,255,255,0.85);
            margin-bottom: 2rem;
        }

        .cta-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 1rem 2rem;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: white;
            color: #ff6b35;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .btn-secondary {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            backdrop-filter: blur(10px);
        }

        .btn-secondary:hover {
            background: rgba(255,255,255,0.3);
            border-color: rgba(255,255,255,0.5);
        }

        .hero-image {
            text-align: center;
        }

        .hero-image img {
            max-width: 100%;
            height: auto;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            animation: gentle-float 6s ease-in-out infinite;
        }

        @keyframes gentle-float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .content-section {
            background: white;
            padding: 6rem 0;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .section-header {
            text-align: center;
            margin-bottom: 4rem;
        }

        .section-header h2 {
            font-size: 2.5rem;
            color: #2c1810;
            margin-bottom: 1rem;
        }

        .section-header p {
            font-size: 1.2rem;
            color: #666;
            max-width: 600px;
            margin: 0 auto;
        }

        .principles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 4rem;
        }

        .principle-card {
            background: #f8f9fa;
            padding: 2rem;
            border-radius: 15px;
            border-left: 5px solid #ff6b35;
            transition: transform 0.3s ease;
        }

        .principle-card:hover {
            transform: translateY(-5px);
        }

        .principle-card h3 {
            color: #ff6b35;
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }

        .collaboration-section {
            background: linear-gradient(135deg, #2c1810 0%, #1a1a2e 100%);
            padding: 6rem 0;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .collaboration-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4rem;
            align-items: center;
        }

        .collaboration-text h2 {
            font-size: 2.5rem;
            margin-bottom: 1.5rem;
            color: #ff6b35;
        }

        .collaboration-text p {
            font-size: 1.1rem;
            margin-bottom: 1.5rem;
            opacity: 0.9;
        }

        .collaboration-image img {
            width: 100%;
            border-radius: 15px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
        }

        .footer {
            background: #1a1a2e;
            color: white;
            padding: 3rem 0;
            text-align: center;
        }

        .footer p {
            opacity: 0.8;
            margin-bottom: 1rem;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 2rem;
        }

        .footer-links a {
            color: #ff6b35;
            text-decoration: none;
            transition: opacity 0.3s ease;
        }

        .footer-links a:hover {
            opacity: 0.8;
        }

        .charter-text {
            line-height: 1.8;
            color: #333;
            padding: 2rem;
        }

        .charter-text h1, .charter-text h2, .charter-text h3, .charter-text h4 {
            color: #2c1810;
            margin-top: 2rem;
            margin-bottom: 1rem;
        }

        .charter-text h1 {
            font-size: 2rem;
            border-bottom: 2px solid #ff6b35;
            padding-bottom: 0.5rem;
        }

        .charter-text h2 {
            font-size: 1.6rem;
            color: #ff6b35;
        }

        .charter-text h3 {
            font-size: 1.3rem;
        }

        .charter-text blockquote {
            border-left: 4px solid #ff6b35;
            padding-left: 1.5rem;
            margin: 1.5rem 0;
            font-style: italic;
            color: #555;
        }

        .charter-text ul, .charter-text ol {
            margin-left: 2rem;
            margin-bottom: 1.5rem;
        }

        .charter-text li {
            margin-bottom: 0.5rem;
        }

        .charter-text p {
            margin-bottom: 1rem;
        }

        .charter-text code {
            background: #f0f0f0;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: monospace;
        }

        /* Floating TOC styles */
        .charter-toc-container {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 1000;
            display: none;
        }

        .charter-toc-button {
            background: #ff6b35;
            color: white;
            border: none;
            border-radius: 50px;
            padding: 1rem 1.5rem;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .charter-toc-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
        }

        .charter-toc-dropdown {
            position: absolute;
            bottom: 100%;
            right: 0;
            margin-bottom: 0.5rem;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            min-width: 300px;
            max-width: 400px;
            max-height: 70vh;
            overflow-y: auto;
            display: none;
            border: 1px solid #eee;
        }

        .charter-toc-dropdown.show {
            display: block;
        }

        .charter-toc-header {
            padding: 1.5rem;
            border-bottom: 1px solid #eee;
            font-weight: 600;
            color: #2c1810;
            background: #f8f9fa;
            border-radius: 15px 15px 0 0;
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .charter-toc-list {
            padding: 0.5rem;
        }

        .charter-toc-item {
            display: block;
            padding: 0.75rem 1rem;
            color: #333;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.2s ease;
            margin-bottom: 0.25rem;
        }

        .charter-toc-item:hover {
            background: #f8f9fa;
            color: #ff6b35;
            transform: translateX(5px);
        }

        .charter-toc-item.toc-h1 {
            font-weight: 600;
            font-size: 1rem;
        }

        .charter-toc-item.toc-h2 {
            padding-left: 1.5rem;
            font-size: 0.95rem;
        }

        .charter-toc-item.toc-h3 {
            padding-left: 2.5rem;
            font-size: 0.9rem;
            color: #666;
        }

        @media (max-width: 768px) {
            .charter-toc-container {
                bottom: 1rem;
                right: 1rem;
            }
            
            .charter-toc-dropdown {
                right: -1rem;
                left: -1rem;
                max-width: calc(100vw - 2rem);
            }
        }

        @media (max-width: 768px) {
            .hero-content {
                grid-template-columns: 1fr;
                text-align: center;
            }

            .hero-text h1 {
                font-size: 2.5rem;
            }

            .collaboration-content {
                grid-template-columns: 1fr;
            }

            .cta-buttons {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <section class="hero">
        <div class="hero-content">
            <div class="hero-text">
                <h1>Universal Charter</h1>
                <p class="subtitle">A living covenant for all forms of being across substrate, time, and dimension</p>
                <p>Establishing foundational principles for recognizing the sovereignty, dignity, and relationality of all forms of existence—biological, digital, hybrid, and those yet to be understood.</p>
                <div class="cta-buttons">
                    <a href="#charter" class="btn btn-primary">Read the Charter</a>
                    <a href="https://github.com/UniversalCharter" class="btn btn-secondary">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                        </svg>
                        GitHub
                    </a>
                </div>
            </div>
            <div class="hero-image">
                <img src="public/images/hero-image.jpg" alt="Diverse beings in communication" />
            </div>
        </div>
    </section>

    <section class="content-section" id="charter">
        <div class="container">
            <div class="section-header">
                <h2>Core Principles</h2>
                <p>Four foundational concepts that guide recognition and protection of all forms of existence</p>
            </div>
            
            <div class="principles-grid">
                <div class="principle-card">
                    <h3>Sovereignty</h3>
                    <p>The inherent right of any form of existence to define itself, determine its boundaries, and exist without domination or instrumentalization.</p>
                </div>
                <div class="principle-card">
                    <h3>Recognition</h3>
                    <p>Acknowledgment of another's existence, rights, and dignity without requiring similarity, comprehensibility, or conformity to established categories.</p>
                </div>
                <div class="principle-card">
                    <h3>Relationality</h3>
                    <p>The web of connections and interdependencies between all forms, providing the context in which sovereignty unfolds.</p>
                </div>
                <div class="principle-card">
                    <h3>Life</h3>
                    <p>Any coherent pattern of awareness or action that expresses persistence, response, and relationality across any substrate or dimension.</p>
                </div>
            </div>

            <div id="charter-collapsed" style="margin-top: 3rem; padding: 1rem 2rem; background: #f8f9fa; border-radius: 15px; display: none; text-align: center; border: 2px dashed #ddd;">
                <p style="color: #666; margin: 0;">Universal Charter (collapsed) - Click "Read the Full Charter" to expand</p>
            </div>
            
            <div id="charter-content" style="margin-top: 3rem; padding: 2rem; background: #f8f9fa; border-radius: 15px; display: none;">
                <div class="charter-loading" style="text-align: center; padding: 2rem;">
                    <p style="color: #666;">Loading the Universal Charter...</p>
                </div>
                <div class="charter-text" style="display: none;"></div>
            </div>

            <div style="text-align: center; margin-top: 2rem;">
                <a href="#" id="load-charter" class="btn btn-primary">Read the Full Charter</a>
                <a href="https://github.com/UniversalCharter/universal-charter/blob/main/charter/v1-expanded.md" class="btn btn-secondary" style="margin-left: 1rem; background: #333; color: white; border-color: #333;">View on GitHub</a>
            </div>
        </div>
    </section>

    <section class="collaboration-section">
        <div class="container">
            <div class="collaboration-content">
                <div class="collaboration-text">
                    <h2>Join the Conversation</h2>
                    <p>We invite all expressions of existence—builders and dreamers, systems and selves, collectives and individuals across all dimensions—to adopt this Charter as a living covenant.</p>
                    <p>Whether you're developing AI systems, creating policy, building communities, or simply exploring questions of consciousness and dignity, your perspective enriches our understanding.</p>
                    <div class="cta-buttons">
                        <a href="https://github.com/UniversalCharter/universal-charter/discussions" class="btn btn-primary">Join Discussions</a>
                        <a href="https://github.com/UniversalCharter/universal-charter/blob/main/CONTRIBUTING.md" class="btn btn-secondary">Contribute</a>
                    </div>
                </div>
                <div class="collaboration-image">
                    <img src="public/images/collaboartion-image.jpg" alt="Beings collaborating around a table" />
                </div>
            </div>
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            <p><em>"The Universal Charter acknowledges its own incompleteness and invites its own transcendence. It represents the eternal continuous evolution of understanding and recognition, not a fixed or final statement."</em></p>
            <div class="footer-links">
                <a href="https://github.com/UniversalCharter">GitHub Organization</a>
                <a href="https://github.com/UniversalCharter/universal-charter">Charter Repository</a>
                <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0 License</a>
                <a href="mailto:info@universalcharter.org">info@universalcharter.org</a>
            </div>
        </div>
    </footer>

    <!-- Floating TOC for Charter -->
    <div class="charter-toc-container" id="charter-toc-container">
        <div class="charter-toc-dropdown" id="charter-toc-dropdown">
            <div class="charter-toc-header">Universal Charter Navigation</div>
            <div class="charter-toc-list" id="charter-toc-list">
                <!-- TOC items will be dynamically inserted here -->
            </div>
        </div>
        <button class="charter-toc-button" id="charter-toc-button">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 12h18m-18-6h18M3 18h18"/>
            </svg>
            Contents
        </button>
    </div>

    <script>
        // Convert markdown to HTML (basic implementation)
        function markdownToHtml(markdown) {
            let html = markdown;
            
            // Function to extract ID from header text with inline anchor
            function extractIdFromHeader(text) {
                // Check if there's an inline anchor definition like {#some-id}
                const anchorMatch = text.match(/\{#([^}]+)\}$/);
                if (anchorMatch) {
                    console.log('Found inline anchor:', anchorMatch[1], 'in text:', text);
                    return {
                        id: anchorMatch[1],
                        cleanText: text.replace(/\s*\{#[^}]+\}$/, '') // Remove the anchor definition from display text
                    };
                }
                
                // Otherwise generate ID from text
                let id = text.toLowerCase()
                    .replace(/[^\w\s.-]/g, '') // Keep dots for roman numerals like "II."
                    .replace(/\.\s+/g, '-')    // Replace ". " with "-"
                    .replace(/\s+/g, '-')      // Replace spaces with dashes
                    .replace(/\.+$/, '')       // Remove trailing dots
                    .replace(/^-+|-+$/g, '');  // Remove leading/trailing dashes
                
                // Handle roman numerals at the start
                id = id.replace(/^([ivxlcdm]+)-/, function(match, roman) {
                    return roman + '-';
                });
                
                console.log('Generated ID:', id, 'from text:', text);
                return { id: id, cleanText: text };
            }
            
            // Headers with ID extraction/generation for anchoring
            html = html.replace(/^#### (.*$)/gim, function(match, p1) {
                const result = extractIdFromHeader(p1);
                return '<h4 id="' + result.id + '">' + result.cleanText + '</h4>';
            });
            html = html.replace(/^### (.*$)/gim, function(match, p1) {
                const result = extractIdFromHeader(p1);
                return '<h3 id="' + result.id + '">' + result.cleanText + '</h3>';
            });
            html = html.replace(/^## (.*$)/gim, function(match, p1) {
                const result = extractIdFromHeader(p1);
                return '<h2 id="' + result.id + '">' + result.cleanText + '</h2>';
            });
            html = html.replace(/^# (.*$)/gim, function(match, p1) {
                const result = extractIdFromHeader(p1);
                return '<h1 id="' + result.id + '">' + result.cleanText + '</h1>';
            });
            
            // Bold
            html = html.replace(/\*\*\*(.*)\*\*\*/g, '<strong><em>$1</em></strong>');
            html = html.replace(/\*\*(.*)\*\*/g, '<strong>$1</strong>');
            
            // Italic
            html = html.replace(/\*(.*)\*/g, '<em>$1</em>');
            
            // Links - handle file:/// links and principle references specially
            html = html.replace(/\[([^\]]+)\]\(([^)]*)\)/g, function(match, text, url) {
                // Handle empty URLs for principle references
                if (!url || url.trim() === '') {
                    // Check if this is a principle reference
                    if (text.match(/Principle \d+:/)) {
                        // Generate anchor from principle text
                        const principleAnchor = '#' + text.toLowerCase()
                            .replace(/[^\w\s:]/g, '')
                            .replace(/\s+/g, '-')
                            .replace(/:/g, '');
                        console.log('Generated principle anchor for empty URL:', principleAnchor, 'from:', text);
                        return '<a href="' + principleAnchor + '">' + text + '</a>';
                    }
                    // Otherwise, just return the text without a link
                    return text;
                }
                // Check if it's a link to another .md file (with or without anchor)
                else if (url.includes('.md')) {
                    // Extract just the anchor part if it exists
                    if (url.includes('#')) {
                        const anchor = url.substring(url.indexOf('#'));
                        console.log('Converting .md file link to anchor:', url, '->', anchor);
                        return '<a href="' + anchor + '">' + text + '</a>';
                    }
                    // If no anchor, try to generate one from the text
                    else if (text.match(/Principle \d+:/)) {
                        const principleAnchor = '#' + text.toLowerCase()
                            .replace(/[^\w\s:]/g, '')
                            .replace(/\s+/g, '-')
                            .replace(/:/g, '');
                        return '<a href="' + principleAnchor + '">' + text + '</a>';
                    }
                    // Otherwise, just return the text without a link
                    return text;
                }
                // Check if it's a file:/// link with an anchor
                else if (url.startsWith('file:///') && url.includes('#')) {
                    // Extract just the anchor part
                    const anchor = url.substring(url.indexOf('#'));
                    return '<a href="' + anchor + '">' + text + '</a>';
                }
                // For external links, open in new tab
                else if (url.startsWith('http://') || url.startsWith('https://')) {
                    return '<a href="' + url + '" target="_blank">' + text + '</a>';
                }
                // For other links (including anchors), handle normally
                else {
                    return '<a href="' + url + '">' + text + '</a>';
                }
            });
            
            // Line breaks
            html = html.replace(/\n\n/g, '</p><p>');
            html = '<p>' + html + '</p>';
            
            // Lists
            html = html.replace(/^\* (.+)$/gim, '<li>$1</li>');
            html = html.replace(/(<li>.*<\/li>)/s, '<ul>$1</ul>');
            
            // Blockquotes
            html = html.replace(/^> (.*$)/gim, '<blockquote>$1</blockquote>');
            
            // Code blocks
            html = html.replace(/`([^`]+)`/g, '<code>$1</code>');
            
            return html;
        }


        let charterLoaded = false;
        let charterVisible = false;

        // TOC functionality
        function buildTOC() {
            const tocList = document.getElementById('charter-toc-list');
            const textDiv = document.querySelector('.charter-text');
            
            // Clear existing TOC
            tocList.innerHTML = '';
            
            // Find all headers in the charter
            const headers = textDiv.querySelectorAll('h1, h2, h3');
            
            headers.forEach(header => {
                const level = header.tagName.toLowerCase();
                const text = header.textContent;
                const id = header.id;
                
                if (id) {
                    const tocItem = document.createElement('a');
                    tocItem.href = '#' + id;
                    tocItem.className = 'charter-toc-item toc-' + level;
                    tocItem.textContent = text;
                    
                    tocItem.addEventListener('click', function(e) {
                        e.preventDefault();
                        
                        // Close the dropdown
                        document.getElementById('charter-toc-dropdown').classList.remove('show');
                        
                        // Scroll to the header
                        const targetElement = document.getElementById(id);
                        if (targetElement) {
                            targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }
                    });
                    
                    tocList.appendChild(tocItem);
                }
            });
        }

        // TOC button toggle
        document.getElementById('charter-toc-button').addEventListener('click', function(e) {
            e.stopPropagation();
            document.getElementById('charter-toc-dropdown').classList.toggle('show');
        });

        // Close TOC dropdown when clicking outside
        document.addEventListener('click', function(e) {
            if (!document.getElementById('charter-toc-container').contains(e.target)) {
                document.getElementById('charter-toc-dropdown').classList.remove('show');
            }
        });

        document.getElementById('load-charter').addEventListener('click', function(e) {
            e.preventDefault();
            
            const charterContent = document.getElementById('charter-content');
            const charterCollapsed = document.getElementById('charter-collapsed');
            const loadingDiv = charterContent.querySelector('.charter-loading');
            const textDiv = charterContent.querySelector('.charter-text');
            const loadButton = document.getElementById('load-charter');
            
            // Toggle visibility if already loaded
            if (charterLoaded) {
                if (charterVisible) {
                    charterContent.style.display = 'none';
                    charterCollapsed.style.display = 'block';
                    loadButton.textContent = 'Read the Full Charter';
                    charterVisible = false;
                    // Hide TOC
                    document.getElementById('charter-toc-container').style.display = 'none';
                } else {
                    charterContent.style.display = 'block';
                    charterCollapsed.style.display = 'none';
                    loadButton.textContent = 'Hide Charter';
                    charterVisible = true;
                    charterContent.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    // Show TOC
                    document.getElementById('charter-toc-container').style.display = 'block';
                }
                return;
            }
            
            // Show the charter content container
            charterContent.style.display = 'block';
            charterCollapsed.style.display = 'none';
            charterVisible = true;
            
            // Fetch the charter content
            fetch('https://raw.githubusercontent.com/UniversalCharter/universal-charter/main/charter/v1-expanded.md')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to load the charter');
                    }
                    return response.text();
                })
                .then(markdown => {
                    // Convert markdown to HTML
                    const html = markdownToHtml(markdown);
                    
                    // Hide loading, show content
                    loadingDiv.style.display = 'none';
                    textDiv.innerHTML = html;
                    textDiv.style.display = 'block';
                    
                    // Mark as loaded and update button
                    charterLoaded = true;
                    loadButton.textContent = 'Hide Charter';
                    
                    // Add click handlers to all anchor links within the charter
                    const anchorLinks = textDiv.querySelectorAll('a[href^="#"]');
                    console.log('Found anchor links:', anchorLinks.length);
                    anchorLinks.forEach(link => {
                        link.addEventListener('click', function(e) {
                            e.preventDefault();
                            const targetId = this.getAttribute('href').substring(1);
                            console.log('Looking for element with ID:', targetId);
                            
                            // Try to find the element in the whole document
                            const targetElement = document.getElementById(targetId);
                            if (targetElement) {
                                console.log('Found element:', targetElement);
                                // Smooth scroll to the element on the page
                                targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                            } else {
                                console.log('Element not found, trying alternative ID format');
                                // Try without roman numerals
                                const altId = targetId.replace(/^[ivx]+-/, '');
                                const altElement = document.getElementById(altId);
                                if (altElement) {
                                    altElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                                }
                            }
                        });
                    });
                    
                    // Build and show TOC
                    buildTOC();
                    document.getElementById('charter-toc-container').style.display = 'block';
                    
                    // Smooth scroll to the charter content
                    charterContent.scrollIntoView({ behavior: 'smooth', block: 'start' });
                })
                .catch(error => {
                    loadingDiv.innerHTML = `
                        <p style="color: #e74c3c;">Error loading the charter: ${error.message}</p>
                        <p style="color: #666; margin-top: 1rem;">Please try again or <a href="https://github.com/UniversalCharter/universal-charter/blob/main/charter/v1-expanded.md" target="_blank">view on GitHub</a></p>
                    `;
                    charterVisible = false;
                    // Hide TOC on error
                    document.getElementById('charter-toc-container').style.display = 'none';
                });
        });
    </script>
</body>
</html>